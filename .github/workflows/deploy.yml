name: Deploy VuePress

env:
  ACTION_DEPLOY_KEY: ${{ secrets.ACTION_DEPLOY_KEY }}
  SERVER_DOMAIN: lyh543.cn
  SERVER_USERNAME: ubuntu

on: [push] # å½“æœ‰æ–°pushæ—¶è¿è¡Œ

jobs:
  build: # ä¸€é¡¹å«åšbuildçš„ä»»åŠ¡

    runs-on: ubuntu-latest # åœ¨æœ€æ–°ç‰ˆçš„Ubuntuç³»ç»Ÿä¸‹è¿è¡Œ
    
    steps:
    - name: Checkout # å°†ä»“åº“å†…masteråˆ†æ”¯çš„å†…å®¹ä¸‹è½½åˆ°å·¥ä½œç›®å½•
      uses: actions/checkout@v1 # è„šæœ¬æ¥è‡ª https://github.com/actions/checkout
      
    - name: Use Node.js 14.x # é…ç½®Nodeç¯å¢ƒ
      uses: actions/setup-node@v1 # é…ç½®è„šæœ¬æ¥è‡ª https://github.com/actions/setup-node
      with:
        node-version: "14.x"
    
    - name: Setup SSH
      run: |
        # set up private key for deploy
        mkdir -p ~/.ssh/
        echo "$ACTION_DEPLOY_KEY" | tr -d '\r' > ~/.ssh/id_rsa # é…ç½®ç§˜é’¥
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan github.com >> ~/.ssh/known_hosts
        ssh-keyscan $SERVER_DOMAIN >> ~/.ssh/known_hosts
        # set git infomation
        git config --global user.name 'lyh543' # æ¢æˆä½ è‡ªå·±çš„é‚®ç®±å’Œåå­—
        git config --global user.email 'lyh543@outlook.com'
  
    - name: Generate Static Websites
      env:
        TZ: Asia/Shanghai
      run: |
        npm i
        npm run build'
    
    - name: Deploy ğŸš€
      uses: JamesIves/github-pages-deploy-action@4.1.4
      with:
        branch: gh-pages # The branch the action should deploy to.
        folder: dist # The folder the action should deploy.
