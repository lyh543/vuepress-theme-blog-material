name: Deploy VuePress Example

on:
  push:
    branches:
      - master

jobs:
  build: # ä¸€é¡¹å«åšbuildçš„ä»»åŠ¡

    runs-on: ubuntu-latest # åœ¨æœ€æ–°ç‰ˆçš„Ubuntuç³»ç»Ÿä¸‹è¿è¡Œ
    
    steps:
    - name: Checkout # å°†ä»“åº“å†…masteråˆ†æ”¯çš„å†…å®¹ä¸‹è½½åˆ°å·¥ä½œç›®å½•
      uses: actions/checkout@v2 # è„šæœ¬æ¥è‡ª https://github.com/actions/checkout
      with:
        ref: 'template'
      
    - name: Use Node.js 16.x # é…ç½®Nodeç¯å¢ƒ
      uses: actions/setup-node@v1 # é…ç½®è„šæœ¬æ¥è‡ª https://github.com/actions/setup-node
      with:
        node-version: "16.x"
  
    - name: Generate Static Websites
      env:
        TZ: Asia/Shanghai
      run: |
        npm i
        npm run build

    - name: Setup SSH env
      env:
        ACTION_DEPLOY_KEY: ${{ secrets.ACTION_DEPLOY_KEY }}
      run: |
        # set up private key for deploy
        mkdir -p ~/.ssh/
        echo "$ACTION_DEPLOY_KEY" | tr -d '\r' > ~/.ssh/id_rsa # é…ç½®ç§˜é’¥
        chmod 600 ~/.ssh/id_rsa
        # ssh-keyscan github.com >> ~/.ssh/known_hosts
        ssh-keyscan lyh543.cn >> ~/.ssh/known_hosts
        # set git infomation
        # git config --global user.name 'lyh543' # æ¢æˆä½ è‡ªå·±çš„é‚®ç®±å’Œåå­—
        # git config --global user.email 'lyh543@outlook.com'

    - name: Deploy ğŸš€ To Server
      run: |
        rsync -av \
          dist/* \
          ubuntu@lyh543.cn:/etc/caddy/html/vuepress-theme-blog-material/
